# Pharynx Wave Detection and Analysis

This project contains Python scripts to detect and analyze pharyngeal pumping events from ABF (Axon Binary Format) recordings, typically used for electrophysiological data.

## Scripts

- `detect_pharynx_waves.py`: This script processes individual ABF files to detect pharyngeal pumping events (E and R waves). It can be run in an interactive mode that allows for manual validation and adjustment of detection thresholds. It generates summary data, metrics, and plots for each recording, saving them as CSV and SVG files.

- `population_analysis.py`: This script performs population-level analysis on the summary and feature data generated by `detect_pharynx_waves.py`. It is designed to compare different experimental groups (e.g., genetic strains) across multiple days or conditions, generating comparative plots and statistical analyses.

## Usage

1.  **Process individual recordings:**
    -   Place your ABF files in a folder.
    -   In `detect_pharynx_waves.py`, update the `folder_path` variable inside the `if __name__ == "__main__":` block to point to your data folder.
    -   Run the script. It will process each `.abf` file, generate plots, and save summary data as `.csv` files in the same folder.

2.  **Perform population analysis:**
    -   Gather all the generated `*_summary.csv` and `*_features_full.csv` files into a single directory.
    -   In `population_analysis.py`, update the `DATA_DIR` variable to point to the directory containing your CSV files.
    -   Run the script. It will generate and save comparative plots and statistical results.

## Dependencies

This project relies on several scientific Python libraries. You can install them using pip:

```bash
pip install numpy pandas matplotlib scipy pyabf seaborn scikit-learn umap-learn statsmodels
```

It is highly recommended to use a virtual environment to manage project dependencies.

## Important Considerations

Before using these scripts, please be aware of the following critical points to ensure the code runs correctly and the results are interpreted properly.

### 1. Hardcoded File Paths

-   **Issue:** Both `detect_pharynx_waves.py` and `population_analysis.py` contain hardcoded, absolute file paths (e.g., `/Users/username/...`).
-   **Impact:** The scripts will fail if run on a different machine.
-   **Solution:** Before running, you **must** manually update the `folder_path` variable in `detect_pharynx_waves.py` and the `DATA_DIR` variable in `population_analysis.py` to point to the correct locations on your system.

### 2. Batch Processing is Not Fully Automated

-   **Issue:** The batch processing mode in `detect_pharynx_waves.py` is semi-interactive. It uses `plt.show()` and `input()` calls within its main loop.
-   **Impact:** The script will pause and wait for user interaction for each file it processes (i.e., you must close each plot window manually). This is not suitable for large, unattended batch jobs.
-   **How it works:** Be prepared to manually close each plot window that appears to allow the script to proceed to the next file in the batch.

### 3. Statistical Analysis Methodology

-   **Issue:** The `population_analysis.py` script performs post-hoc t-tests (Fisher's LSD) after an ANOVA to compare groups, but it does **not** apply a correction for multiple comparisons (e.g., Bonferroni, Tukey HSD).
-   **Impact:** This increases the risk of Type I errors (false positives). The p-values from the post-hoc tests should be interpreted with caution.
-   **Recommendation:** For a rigorous scientific analysis, it is strongly recommended to apply a multiple comparisons correction to the resulting p-values before drawing conclusions.

### 4. Data File Naming Convention

-   **Issue:** The `population_analysis.py` script relies on a strict file naming convention (`<strain> dia <day>_...`) to extract metadata.
-   **Impact:** If your CSV files do not follow this exact pattern, the script may fail to extract metadata or, worse, assign it incorrectly, leading to flawed analysis.
-   **Recommendation:** Ensure all your summary and feature CSV files are named correctly before running the population analysis. For example: `N2 dia 3_summary.csv`.
